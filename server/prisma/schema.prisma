// database definitions

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  fullName  String
  account   Account? // Quan hệ 1-1 với Account
  createdAt DateTime @default(now())
}

model Account {
  id           String        @id @default(uuid())
  userId       String        @unique
  user         User          @relation(fields: [userId], references: [id])
  balance      Float         @default(0) // Số dư tiền mặt
  transactions Transaction[]
  portfolio    Portfolio[]
}

model Portfolio {
  id        String   @id @default(uuid())
  accountId String
  account   Account  @relation(fields: [accountId], references: [id])
  symbol    String   // Mã CP (VNM, FPT...)
  quantity  Int      // Số lượng nắm giữ
  avgPrice  Float    // Giá vốn trung bình

  @@unique([accountId, symbol]) // Một tài khoản chỉ có 1 dòng cho mỗi mã CP
}

model Transaction {
  id        String   @id @default(uuid())
  accountId String
  account   Account  @relation(fields: [accountId], references: [id])
  type      String   // BUY, SELL, DEPOSIT
  symbol    String?
  amount    Float    // Tổng giá trị giao dịch
  quantity  Int?     // Số lượng CP (nếu là BUY/SELL)
  price     Float?   // Giá khớp lệnh
  createdAt DateTime @default(now())
}